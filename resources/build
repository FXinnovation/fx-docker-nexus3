#!/bin/sh
set -e -x

mkdir -p ${NEXUS_PLUGINS}
curl -Ssl \
  -o ${NEXUS_PLUGINS}/nexus3-keycloak-plugin-${KEYCLOAK_PLUGIN_VERSION}.jar \
  "https://github.com/flytreeleft/nexus3-keycloak-plugin/releases/download/${KEYCLOAK_PLUGIN_VERSION}/nexus3-keycloak-plugin-${KEYCLOAK_PLUGIN_VERSION}.jar"

chmod 644 ${NEXUS_PLUGINS}/nexus3-keycloak-plugin-${KEYCLOAK_PLUGIN_VERSION}.jar
echo "reference\\:file\\nexus3-keycloak-plugin-${KEYCLOAK_PLUGIN_VERSION}.jar = 200" >> ${NEXUS_HOME}/etc/karaf/startup.properties

chown -R nexus:nexus /opt/sonatype
